angular.module("app.issues.controllers",["ngRoute"]),angular.module("app.issues.controllers").controller("issuesCtrl",["$scope","$location","issuesService","$element",function(e,s,r,t){e.showloading=!0,r.getIssues.then(function(s){e.attachment=[],e.showloading=!1,s.forEach(function(e,s){r.getIssue(e.id).then(function(s){"object"==typeof s.fields.attachment[0]?e.attachment=s.fields.attachment[0].content:e.attachment="http://placehold.it/900x300"})}),e.issues=s})}]),angular.module("app.issues.controllers").controller("issueCtrl",["$scope","$element","$location","issuesService",function(e,s,r,t){function o(s){t.getIssue(n).then(function(r){var o=r.fields,n=o.customfield_10201,i=null===o.customfield_10205?"not-started":o.customfield_10205.value,u=null===o.customfield_10206?"not-started":o.customfield_10206.value,c="done"===u?100:50,p="done"===i?100:50;t.computeScene(e,n,a),t.computeDoc(e,u,a),t.computeDrawing(e,i,a),e.summary=o.summary,e.description=o.description,e.attachment=o.attachment[0].content,e.doc=u,e.drawing=i,e.doc_value=c,e.drawing_value=p,e.updated="updated: "+moment(o.updated).fromNow(),t.computeTotal(e,a),s&&(e.showloading=!1)})}e.showloading=!0;var n=s.find("#issue-key").val(),a=["progress-bar-danger progress-bar-striped","progress-bar-warning progress-bar-striped active","progress-bar-info progress-bar-striped active","progress-bar-success progress-bar-striped active","progress-bar-success","progress-bar-danger progress-bar-striped active","progress-bar-success progress-bar"];o(!0),setInterval(function(){o()},3e5)}]),angular.module("app.issues.directives",["ngRoute"]),angular.module("app.issues.services",[]),angular.module("app.issues.services").service("issuesService",["$http",function(e){this.getIssues=e({method:"GET",url:"/jira/issues",headers:{"Content-type":"application/json"}}).then(function(e){return e.data.issues},function(e){throw new Error(e.responseText)}),this.getIssue=function(s){return e({method:"GET",url:"/jira/issue/"+s,headers:{"Content-type":"application/json"}}).then(function(e){return e.data},function(e){throw new Error(e.responseText)})},this.computeScene=function(e,s,r){var t=$.Deferred();if(null===s)console.log("no scenes");else{var o=s.split(","),n={},a=0,i=t.pipe(function(e,s){var r=100*e,t=s/r,o=100*t;return o==isNaN?0:Math.round(o)});for(var u in o){var c=o[u].split(":"),p=c[0],l=c[1];a+=parseInt(l),n[p]=l}t.resolve(Object.keys(n).length,a),i.done(function(s){e.total=s,s<25&&(e.scene_progress=r[0]),s>=25&&s<=50&&(e.scene_progress=r[1]),s>=50&&s<=75&&(e.scene_progress=r[2]),s>=75&&s<=99&&(e.scene_progress=r[3]),100==s&&(e.scene_progress=r[4])})}},this.computeDoc=function(e,s,r){null===s?console.log("no docs"):"not-started"==s?e.doc_progress=r[5]:"in-progress"==s?e.doc_progress=r[1]:"done"==s&&(e.doc_progress=r[6])},this.computeDrawing=function(e,s,r){null===s?console.log("no drawing"):"not-started"==s?e.drawing_progress=r[5]:"in-progress"==s?e.drawing_progress=r[1]:"done"==s&&(e.drawing_progress=r[6])},this.addUp=function(e){var s=e;return s},this.computeTotal=function(e,s){var r=$.Deferred(),t=e.doc_value+e.drawing_value+e.total,o=r.pipe(function(e){var s=e,r=s/300,t=100*r;return t==isNaN?0:Math.round(t)});r.resolve(this.addUp(t)),o.done(function(r){e.total_progress=r,r<25&&(e.total_progressbar=s[0]),r>=25&&r<=50&&(e.total_progressbar=s[1]),r>=50&&r<=75&&(e.total_progressbar=s[2]),r>=75&&r<=99&&(e.total_progressbar=s[3]),100==r&&(e.total_progressbar=s[4])})}}]),angular.module("jiraApp",["app.issues.services","app.issues.controllers","ngRoute"]);