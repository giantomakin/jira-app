angular.module("app.issues.controllers",["ngRoute"]),angular.module("app.issues.controllers").controller("issuesCtrl",["$scope","$location","issuesService","$element",function(e,s,r,t){e.showloading=!0,r.getIssues.then(function(s){e.attachment=[],e.showloading=!1,s.forEach(function(e,s){r.getIssue(e.id).then(function(s){"object"==typeof s.fields.attachment[0]?e.attachment=s.fields.attachment[0].content:e.attachment="http://placehold.it/900x300"})}),e.issues=s})}]),angular.module("app.issues.controllers").controller("issueCtrl",["$scope","$element","$location","$timeout","issuesService",function(e,s,r,t,o){function n(s){o.getIssue(a).then(function(s){var r=s.fields,t=r.customfield_10201,n=null===r.customfield_10205?"not-started":r.customfield_10205.value,a=null===r.customfield_10206?"not-started":r.customfield_10206.value,u="done"===a?100:50,c="done"===n?100:50;o.computeScene(e,t,i),o.computeDoc(e,a,i),o.computeDrawing(e,n,i),e.summary=r.summary,e.description=r.description.replace(/\*/g," "),e.attachment=r.attachment[0].content,e.doc=a,e.drawing=n,e.doc_value=u,e.drawing_value=c,e.updated="updated: "+moment(r.updated).fromNow(),o.computeTotal(e,i)}),s&&(e.showloading=!1),console.log("Beat at "+(new Date).getTime()+"ms"),t(function(){n()},1e3)}e.showloading=!0;var a=s.find("#issue-key").val(),i=["progress-bar-danger progress-bar-striped","progress-bar-warning progress-bar-striped active","progress-bar-info progress-bar-striped active","progress-bar-success progress-bar-striped active","progress-bar-success","progress-bar-danger progress-bar-striped active","progress-bar-success progress-bar"];n(!0)}]),angular.module("app.issues.directives",["ngRoute"]),angular.module("app.issues.services",[]),angular.module("app.issues.services").service("issuesService",["$http",function(e){this.getIssues=e({method:"GET",url:"/jira/issues",headers:{"Content-type":"application/json"}}).then(function(e){return e.data.issues},function(e){throw new Error(e.responseText)}),this.getIssue=function(s){return e({method:"GET",url:"/jira/issue/"+s,headers:{"Content-type":"application/json"}}).then(function(e){return e.data},function(e){throw new Error(e.responseText)})},this.computeScene=function(e,s,r){var t=$.Deferred();if(null===s)console.log("no scenes");else{var o=s.split(","),n={},a=0,i=t.pipe(function(e,s){var r=100*e,t=s/r,o=100*t;return o==isNaN?0:Math.round(o)});for(var u in o){var c=o[u].split(":"),l=c[0],p=c[1];a+=parseInt(p),n[l]=p}t.resolve(Object.keys(n).length,a),i.done(function(s){e.total=s,s<25&&(e.scene_progress=r[0]),s>=25&&s<=50&&(e.scene_progress=r[1]),s>=50&&s<=75&&(e.scene_progress=r[2]),s>=75&&s<=99&&(e.scene_progress=r[3]),100==s&&(e.scene_progress=r[4])})}},this.computeDoc=function(e,s,r){null===s?console.log("no docs"):"not-started"==s?e.doc_progress=r[5]:"in-progress"==s?e.doc_progress=r[1]:"done"==s&&(e.doc_progress=r[6])},this.computeDrawing=function(e,s,r){null===s?console.log("no drawing"):"not-started"==s?e.drawing_progress=r[5]:"in-progress"==s?e.drawing_progress=r[1]:"done"==s&&(e.drawing_progress=r[6])},this.addUp=function(e){var s=e;return s},this.computeTotal=function(e,s){var r=$.Deferred(),t=e.doc_value+e.drawing_value+e.total,o=r.pipe(function(e){var s=e,r=s/300,t=100*r;return t==isNaN?0:Math.round(t)});r.resolve(this.addUp(t)),o.done(function(r){e.total_progress=r,r<25&&(e.total_progressbar=s[0]),r>=25&&r<=50&&(e.total_progressbar=s[1]),r>=50&&r<=75&&(e.total_progressbar=s[2]),r>=75&&r<=99&&(e.total_progressbar=s[3]),100==r&&(e.total_progressbar=s[4])})}}]),angular.module("jiraApp",["app.issues.services","app.issues.controllers","ngRoute"]);